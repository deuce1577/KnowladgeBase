# –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏–∑ –æ—Ä–¥–µ—Ä–æ–≤

## –û–±–∑–æ—Ä –º–µ—Ç–æ–¥–∞
`Portfolio.from_orders()` - —Å–∞–º—ã–π –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π —Å–∏–º—É–ª—è—Ç–æ—Ä VectorBT PRO, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –æ—Ä–¥–µ—Ä–∞ –∏ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- **–ü—Ä–æ—Å—Ç—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π** —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –∑–∞—Ä–∞–Ω–µ–µ –æ—Ä–¥–µ—Ä–∞–º–∏
- **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞** –≥–æ—Ç–æ–≤—ã—Ö —Ç–æ—Ä–≥–æ–≤—ã—Ö –∂—É—Ä–Ω–∞–ª–æ–≤
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **–û–±—É—á–µ–Ω–∏—è** –æ—Å–Ω–æ–≤–∞–º VectorBT

### ‚ùå –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π**, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–º—É–ª—è—Ü–∏–∏
- **–£—Å–ª–æ–≤–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤** (stop-loss, take-profit)
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ** –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–∑–∏—Ü–∏–π

## –ë–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

```python
import vectorbt as vbt

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
data = vbt.YFData.pull("BTC-USD", period="1y")

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏–∑ –æ—Ä–¥–µ—Ä–æ–≤
portfolio = vbt.Portfolio.from_orders(
    data,
    size=100,           # –†–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞
    price=data.close,   # –¶–µ–Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    direction="both"    # –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–∏
)
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ä–¥–µ—Ä–æ–≤

### üìä –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### Size (–†–∞–∑–º–µ—Ä)
```python
# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
size = 100

# –ú–∞—Å—Å–∏–≤ —Ä–∞–∑–º–µ—Ä–æ–≤
size = [100, 200, 150, 300]

# –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞
size = 0.1  # 10% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
```

#### Price (–¶–µ–Ω–∞)
```python
# –¶–µ–Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
price = data.close

# –¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è
price = data.open.shift(-1)

# –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞
price = (data.high + data.low) / 2

# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞
price = 50000  # –î–ª—è –≤—Å–µ—Ö –æ—Ä–¥–µ—Ä–æ–≤
```

#### Direction (–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
```python
direction = "both"     # –î–ª–∏–Ω–Ω—ã–µ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏
direction = "longonly" # –¢–æ–ª—å–∫–æ –¥–ª–∏–Ω–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
direction = "shortonly"# –¢–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏
```

### üí∞ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

#### Fees (–ö–æ–º–∏—Å—Å–∏–∏)
```python
# –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è
fees = 0.001  # 0.1%

# –†–∞–∑–Ω—ã–µ –∫–æ–º–∏—Å—Å–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
fees = [0.001, 0.002, 0.0015]

# –ê–±—Å–æ–ª—é—Ç–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è
fixed_fees = 5.0  # $5 –∑–∞ –æ—Ä–¥–µ—Ä
```

#### Slippage (–ü—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ)
```python
# –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
slippage = 0.0005  # 0.05%

# –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
slippage = 10  # $10 –ø—Ä–æ—Å–∫–∞–ª—å–∑—ã–≤–∞–Ω–∏–µ
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### üéØ –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–∫—É–ø–∫–∏ –∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è

```python
# –ü–æ–∫—É–ø–∫–∞ –≤ –Ω–∞—á–∞–ª–µ, –ø—Ä–æ–¥–∞–∂–∞ –≤ –∫–æ–Ω—Ü–µ
size = [100, -100]  # –ü–æ–∫—É–ø–∫–∞ 100, –ø—Ä–æ–¥–∞–∂–∞ 100
price = [data.close.iloc[0], data.close.iloc[-1]]

portfolio = vbt.Portfolio.from_orders(
    data,
    size=size,
    price=price,
    init_cash=10000
)

print(f"–ò—Ç–æ–≥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {portfolio.total_return():.2%}")
```

### üìà –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏ (DCA)

```python
# –ü–æ–∫—É–ø–∫–∞ –∫–∞–∂–¥—ã–µ 30 –¥–Ω–µ–π
buy_dates = data.index[::30]  # –ö–∞–∂–¥—ã–π 30-–π –¥–µ–Ω—å
size = [100] * len(buy_dates)  # –ü–æ 100 –µ–¥–∏–Ω–∏—Ü
price = data.close.loc[buy_dates]

portfolio = vbt.Portfolio.from_orders(
    data,
    size=size,
    price=price,
    init_cash=50000
)
```

### üîÑ –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø–æ—Ä—Ç—Ñ–µ–ª—è

```python
# –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü
rebalance_dates = data.index[::30]
target_position = 1000  # –¶–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è

# –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ –¥–ª—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
sizes = []
for i, date in enumerate(rebalance_dates):
    if i == 0:
        sizes.append(target_position)  # –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∫—É–ø–∫–∞
    else:
        # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–æ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏
        current_pos = portfolio.position.loc[date]
        adjustment = target_position - current_pos
        sizes.append(adjustment)

portfolio = vbt.Portfolio.from_orders(
    data,
    size=sizes,
    price=data.close.loc[rebalance_dates]
)
```

## –ì–∏–±–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

### üéõÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ broadcasting

```python
# –û–¥–∏–Ω —Ä–∞–∑–º–µ—Ä –¥–ª—è –≤—Å–µ—Ö –æ—Ä–¥–µ—Ä–æ–≤
size = 100

# –û–¥–∏–Ω —Ä–∞–∑–º–µ—Ä –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–∏–æ–¥–∞
size_per_time = [100, 150, 200, 250]

# –ü–æ–ª–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞ (–≤—Ä–µ–º—è √ó –∞–∫—Ç–∏–≤—ã)
size_matrix = np.random.randint(50, 200, size=(len(data), 1))

portfolio = vbt.Portfolio.from_orders(
    data,
    size=size,  # VectorBT –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –∫–æ –≤—Å–µ–º
    price=data.close
)
```

### üîÑ –†–æ—Ç–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è

```python
# –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–æ–≤
sizes = [100, 200, 300]  # 3 –∑–Ω–∞—á–µ–Ω–∏—è
# –î–ª—è 1000 –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ –±—É–¥–µ—Ç: 100,200,300,100,200,300,...

portfolio = vbt.Portfolio.from_orders(
    data,
    size=sizes,
    price=data.close
)
```

## –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üìä –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```python
# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ
portfolio = vbt.Portfolio.from_orders(data, size=100, price=data.close)

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
print(f"–û–±—â–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: {portfolio.total_return():.2%}")
print(f"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ—Å–∞–¥–∫–∞: {portfolio.max_drawdown():.2%}")
print(f"–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –®–∞—Ä–ø–∞: {portfolio.sharpe_ratio():.2f}")
print(f"–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–¥–µ–ª–æ–∫: {portfolio.trades.count()}")

# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
portfolio.plot().show()
```

### üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

```python
# –ê–Ω–∞–ª–∏–∑ –æ—Ä–¥–µ—Ä–æ–≤
orders = portfolio.orders
print(f"–ò—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤: {orders.count()}")
print(f"–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –æ—Ä–¥–µ—Ä–∞: {orders.size.mean():.2f}")

# –ê–Ω–∞–ª–∏–∑ —Å–¥–µ–ª–æ–∫
trades = portfolio.trades
print(f"–ü—Ä–∏–±—ã–ª—å–Ω—ã—Ö —Å–¥–µ–ª–æ–∫: {trades.win_rate:.2%}")
print(f"–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å: {trades.pnl.mean():.2f}")
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏
- [[–ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ —Å–∏–º—É–ª—è—Ü–∏—è - –∫–æ–Ω—Ü–µ–ø—Ü–∏—è]]
- [[–ü—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã]]
- [[–ì–∏–±–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è]]

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- [[–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏–∑ —Å–∏–≥–Ω–∞–ª–æ–≤]]
- [[–ö–∞–∫ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ]]
- [[–ö–∞–∫ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã]]

#vectorbt #portfolio #from-orders #how-to #backtesting #tutorial

---
**–ò—Å—Ç–æ—á–Ω–∏–∫**: [VectorBT PRO From Orders](https://vectorbt.pro/pvt_7bb7e815/documentation/portfolio/from-orders/)  
**API**: `Portfolio.from_orders()`